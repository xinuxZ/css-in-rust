# CSS-in-Rust 项目规则

## 项目概述

本项目旨在基于 `stylers + lightningcss` 组合方案，为 `ant-design-dioxus` 项目实现高性能、类型安全的 CSS-in-Rust 解决方案。

## 1. 技术架构原则

### 1.1 核心架构
- **分层设计**：解析层 → 抽象层 → 适配层 → 运行时层
- **模块化开发**：每个功能模块独立开发、测试、部署
- **接口标准化**：统一的 API 设计，确保框架无关性
- **零成本抽象**：编译时优化，运行时无额外开销

### 1.2 技术栈选择
- **核心引擎**：stylers (宏系统) + lightningcss (解析优化)
- **目标框架**：Dioxus 0.6.3+
- **构建工具**：Cargo + 自定义构建脚本
- **测试框架**：cargo test + criterion (性能测试)

### 1.3 架构约束
- 必须保持与现有 `ant-design-dioxus` 项目的兼容性
- 不得引入运行时依赖冲突
- 必须支持渐进式迁移
- 确保向后兼容性

## 2. 性能要求

### 2.1 编译时性能
- CSS 解析时间：< 100ms (单个文件)
- 宏展开时间：< 50ms (单个宏调用)
- 增量编译支持：必须

### 2.2 运行时性能
- 样式注入时间：< 1ms
- 内存占用增量：< 10MB
- 包体积增量：< 50KB (gzipped)

### 2.3 性能基准
- 与原生 CSS 性能差异：< 5%
- 与其他 CSS-in-JS 方案对比：性能提升 > 50%

## 3. 开发规范

### 3.1 代码规范
- **Rust 风格**：严格遵循 `rustfmt` 和 `clippy` 规范
- **命名约定**：
  - 模块：snake_case
  - 结构体/枚举：PascalCase
  - 函数/变量：snake_case
  - 常量：SCREAMING_SNAKE_CASE
- **文档要求**：所有公开 API 必须有完整的文档注释
- **错误处理**：使用 `Result<T, E>` 类型，避免 `panic!`

### 3.2 Git 工作流
- **分支策略**：GitFlow
  - `main`：生产版本
  - `develop`：开发版本
  - `feature/*`：功能分支
  - `hotfix/*`：紧急修复
- **提交规范**：Conventional Commits
  - `feat:`：新功能
  - `fix:`：错误修复
  - `docs:`：文档更新
  - `style:`：代码格式
  - `refactor:`：重构
  - `test:`：测试相关
  - `chore:`：构建/工具相关

### 3.3 代码审查
- 所有代码必须经过至少一人审查
- 审查重点：架构设计、性能影响、安全性、可维护性
- 自动化检查：格式、测试、性能基准

## 4. 质量标准

### 4.1 测试要求
- **单元测试覆盖率**：> 90%
- **集成测试**：核心功能必须有集成测试
- **性能测试**：关键路径必须有性能基准测试
- **兼容性测试**：支持的浏览器和框架版本

### 4.2 文档要求
- **API 文档**：所有公开接口必须有完整文档
- **使用指南**：详细的使用示例和最佳实践
- **架构文档**：系统设计和技术决策记录
- **迁移指南**：从现有方案迁移的详细步骤

### 4.3 安全要求
- **类型安全**：利用 Rust 类型系统防止运行时错误
- **内存安全**：无内存泄漏、无悬垂指针
- **输入验证**：所有外部输入必须验证
- **依赖安全**：定期更新依赖，修复安全漏洞

## 5. 集成策略

### 5.1 与 ant-design-dioxus 集成
- **渐进式迁移**：支持新旧方案并存
- **API 兼容**：保持现有组件 API 不变
- **样式兼容**：确保视觉效果一致
- **性能优化**：利用新方案提升整体性能

### 5.2 框架适配
- **Dioxus 优先**：优先支持 Dioxus 框架
- **扩展性设计**：为支持其他框架预留接口
- **插件机制**：支持第三方扩展

## 6. 发布流程

### 6.1 版本管理
- **语义化版本**：严格遵循 SemVer
- **变更日志**：详细记录每个版本的变更
- **向后兼容**：主版本号变更前必须有迁移指南

### 6.2 发布检查清单
- [ ] 所有测试通过
- [ ] 性能基准达标
- [ ] 文档更新完整
- [ ] 安全扫描通过
- [ ] 兼容性测试通过
- [ ] 变更日志更新

## 7. 风险管控

### 7.1 技术风险
- **依赖冲突**：定期检查依赖兼容性
- **性能回归**：持续性能监控
- **兼容性问题**：多环境测试

### 7.2 项目风险
- **进度延期**：里程碑监控，及时调整
- **资源不足**：合理分配开发资源
- **需求变更**：变更影响评估

### 7.3 应急预案
- **回滚策略**：保持旧版本可用
- **降级方案**：关键功能的备选实现
- **问题响应**：24小时内响应关键问题

## 8. 成功标准

### 8.1 功能完整性
- [ ] 完整的 CSS-in-Rust 宏系统
- [ ] 高性能的样式解析和优化
- [ ] 完善的主题和变体系统
- [ ] 与 ant-design-dioxus 无缝集成

### 8.2 性能指标
- [ ] 编译时性能达标
- [ ] 运行时性能达标
- [ ] 包体积控制在目标范围内

### 8.3 质量指标
- [ ] 测试覆盖率 > 90%
- [ ] 文档完整性 > 95%
- [ ] 零关键安全漏洞

### 8.4 生态指标
- [ ] 开发工具完善
- [ ] 社区文档齐全
- [ ] 示例项目可用

---

**项目负责人**：AI 架构师
**创建时间**：2024年
**最后更新**：2024年
**版本**：v1.0
