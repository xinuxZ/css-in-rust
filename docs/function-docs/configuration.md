# ÈÖçÁΩÆÊåáÂçó

Êú¨ÊåáÂçóËØ¶ÁªÜ‰ªãÁªç CSS-in-Rust ÁöÑÂêÑÁßçÈÖçÁΩÆÈÄâÈ°πÔºåÂ∏ÆÂä©ÊÇ®Ê†πÊçÆÈ°πÁõÆÈúÄÊ±ÇËøõË°åÊúÄ‰Ω≥ÈÖçÁΩÆ„ÄÇ

## üìã ÈÖçÁΩÆÊ¶ÇËßà

CSS-in-Rust ÊîØÊåÅÂ§öÁßçÈÖçÁΩÆÊñπÂºèÔºö

- **È°πÁõÆÈÖçÁΩÆÊñá‰ª∂** (`css-in-rust.toml`)
- **Cargo.toml ÈÖçÁΩÆ**
- **ÁéØÂ¢ÉÂèòÈáè**
- **ÊûÑÂª∫ËÑöÊú¨ÈÖçÁΩÆ** (`build.rs`)
- **ËøêË°åÊó∂ÈÖçÁΩÆ**

## üîß È°πÁõÆÈÖçÁΩÆÊñá‰ª∂

### 1. Âü∫Á°ÄÈÖçÁΩÆ (`css-in-rust.toml`)

```toml
# css-in-rust.toml
[project]
name = "my-web-app"
version = "0.1.0"
output_dir = "dist"
cache_dir = ".cache/css-in-rust"

# ÁºñËØëÈÖçÁΩÆ
[compilation]
# ÂêØÁî®Ê≠ª‰ª£Á†ÅÊ∂àÈô§
dead_code_elimination = true
# CSS ÂéãÁº©
minify = true
# ÁîüÊàê Source Map
source_maps = true
# ÂêØÁî®Â¢ûÈáèÁºñËØë
incremental = true
# Âπ∂Ë°åÁºñËØë
parallel = true
max_parallel_jobs = 4

# ÂºÄÂèëÈÖçÁΩÆ
[development]
# ÂêØÁî®ÁÉ≠Êõ¥Êñ∞
hot_reload = true
# WebSocket Á´ØÂè£
websocket_port = 3001
# ÁõëÊéßÊñá‰ª∂Ê®°Âºè
watch_patterns = [
    "src/**/*.rs",
    "components/**/*.rs",
    "styles/**/*.css"
]
# ÂøΩÁï•Ê®°Âºè
ignore_patterns = [
    "target/**",
    "**/.git/**",
    "**/node_modules/**",
    "**/*.tmp"
]
# Èò≤ÊäñÂª∂Ëøü (ÊØ´Áßí)
debounce_ms = 50

# Áîü‰∫ßÈÖçÁΩÆ
[production]
# ÂêØÁî®ÊøÄËøõ‰ºòÂåñ
aggressive_optimization = true
# CSS ÂéãÁº©Á∫ßÂà´ (1-9)
compression_level = 9
# ÁßªÈô§Êú™‰ΩøÁî®ÁöÑ CSS
remove_unused_css = true
# ÂÜÖËÅîÂ∞èÊñá‰ª∂ÈòàÂÄº (Â≠óËäÇ)
inline_threshold = 1024
# ÂêØÁî® Brotli ÂéãÁº©
brotli_compression = true

# ‰∏ªÈ¢òÈÖçÁΩÆ
[theme]
# ÈªòËÆ§‰∏ªÈ¢ò
default = "light"
# ‰∏ªÈ¢òÊñá‰ª∂Ë∑ØÂæÑ
themes_dir = "themes"
# ÊîØÊåÅÁöÑ‰∏ªÈ¢ò
themes = ["light", "dark", "auto"]
# ÂêØÁî®‰∏ªÈ¢òÂàáÊç¢Âä®Áîª
animated_transitions = true
# ‰∏ªÈ¢òÂàáÊç¢ÊåÅÁª≠Êó∂Èó¥ (ÊØ´Áßí)
transition_duration = 300

# ÊÄßËÉΩÈÖçÁΩÆ
[performance]
# ÂêØÁî®ÁºìÂ≠ò
enable_caching = true
# ÁºìÂ≠òÁ≠ñÁï•
cache_strategy = "aggressive" # "conservative", "balanced", "aggressive"
# ÊúÄÂ§ßÁºìÂ≠òÂ§ßÂ∞è (MB)
max_cache_size = 100
# ÁºìÂ≠òËøáÊúüÊó∂Èó¥ (Â∞èÊó∂)
cache_ttl = 24
# ÂêØÁî®È¢ÑÂä†ËΩΩ
preload_critical_css = true
# ÊáíÂä†ËΩΩÈòàÂÄº
lazy_load_threshold = 2048

# ËØäÊñ≠ÈÖçÁΩÆ
[diagnostics]
# ÂêØÁî®ËØ¶ÁªÜÊó•Âøó
verbose_logging = false
# Êó•ÂøóÁ∫ßÂà´
log_level = "info" # "error", "warn", "info", "debug", "trace"
# ÊÄßËÉΩÁõëÊéß
performance_monitoring = true
# ÁîüÊàêÊûÑÂª∫Êä•Âëä
generate_reports = true
# Êä•ÂëäËæìÂá∫ÁõÆÂΩï
reports_dir = "reports"

# Ê°ÜÊû∂ÁâπÂÆöÈÖçÁΩÆ
[frameworks]
# Yew ÈÖçÁΩÆ
[frameworks.yew]
enabled = true
features = ["hot-reload", "theme-support"]

# Leptos ÈÖçÁΩÆ
[frameworks.leptos]
enabled = false
ssr = true
hydration = true

# Dioxus ÈÖçÁΩÆ
[frameworks.dioxus]
enabled = false
platforms = ["web", "desktop"]

# Êèí‰ª∂ÈÖçÁΩÆ
[plugins]
# PostCSS Êèí‰ª∂
postcss = [
    "autoprefixer",
    "cssnano"
]
# Ëá™ÂÆö‰πâÊèí‰ª∂
custom = [
    { name = "my-plugin", path = "./plugins/my-plugin.js" }
]

# ËæìÂá∫ÈÖçÁΩÆ
[output]
# CSS Êñá‰ª∂ÂêçÊ®°Âºè
css_filename = "[name].[contenthash:8].css"
# JS Êñá‰ª∂ÂêçÊ®°Âºè
js_filename = "[name].[contenthash:8].js"
# ËµÑÊ∫êÊñá‰ª∂ÂêçÊ®°Âºè
asset_filename = "assets/[name].[contenthash:8][ext]"
# ÂÖ¨ÂÖ±Ë∑ØÂæÑ
public_path = "/"
# ÂêØÁî®Êñá‰ª∂ÂìàÂ∏å
hash_filenames = true

# ÂÆûÈ™åÊÄßÂäüËÉΩ
[experimental]
# ÂêØÁî® CSS Ê®°Âùó
css_modules = false
# ÂêØÁî® CSS-in-JS ÂÖºÂÆπÊ®°Âºè
css_in_js_compat = false
# ÂêØÁî®ÂéüÂ≠êÂåñ CSS
atomic_css = false
# ÂêØÁî®ËøêË°åÊó∂‰∏ªÈ¢òÂàáÊç¢
runtime_theming = true
```

### 2. ÁéØÂ¢ÉÁâπÂÆöÈÖçÁΩÆ

```toml
# css-in-rust.development.toml
[compilation]
minify = false
source_maps = true
optimization_level = 0

[development]
hot_reload = true
verbose_logging = true

[performance]
cache_strategy = "conservative"

# css-in-rust.production.toml
[compilation]
minify = true
source_maps = false
optimization_level = 3

[production]
aggressive_optimization = true
remove_unused_css = true

[performance]
cache_strategy = "aggressive"
preload_critical_css = true
```

## ü¶Ä Cargo.toml ÈÖçÁΩÆ

### 1. Âü∫Á°Ä‰æùËµñÈÖçÁΩÆ

```toml
# Cargo.toml
[package]
name = "my-web-app"
version = "0.1.0"
edition = "2021"

[dependencies]
# Ê†∏ÂøÉ‰æùËµñ
css-in-rust = { version = "0.1.0", features = [
    "yew",           # Yew Ê°ÜÊû∂ÊîØÊåÅ
    "hot-reload",    # ÁÉ≠Êõ¥Êñ∞ÊîØÊåÅ
    "theme-system",  # ‰∏ªÈ¢òÁ≥ªÁªü
    "performance",   # ÊÄßËÉΩ‰ºòÂåñ
    "diagnostics",   # ËØäÊñ≠Â∑•ÂÖ∑
] }

# Ê°ÜÊû∂‰æùËµñ
yew = { version = "0.21", features = ["csr"] }
wasm-bindgen = "0.2"
web-sys = "0.3"

# Â∫èÂàóÂåñÊîØÊåÅ
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"

# ÂºÇÊ≠•ÊîØÊåÅ
tokio = { version = "1.0", features = ["full"] }
futures = "0.3"

[build-dependencies]
# ÊûÑÂª∫Êó∂‰æùËµñ
css-in-rust = { version = "0.1.0", features = ["build-tools"] }

[dev-dependencies]
# ÂºÄÂèë‰æùËµñ
wasm-bindgen-test = "0.3"

# ÁâπÊÄßÈÖçÁΩÆ
[features]
default = ["web"]
web = ["yew", "hot-reload"]
ssr = ["leptos/ssr"]
desktop = ["dioxus/desktop"]
hot-reload = ["css-in-rust/hot-reload"]
theme-system = ["css-in-rust/theme-system"]
performance = ["css-in-rust/performance"]
diagnostics = ["css-in-rust/diagnostics"]

# ‰ºòÂåñÈÖçÁΩÆ
[profile.release]
opt-level = 3
lto = true
codegen-units = 1
panic = "abort"

[profile.dev]
opt-level = 0
debug = true

# WASM ÁâπÂÆöÈÖçÁΩÆ
[profile.release.package."*"]
opt-level = 3

# Â∑•‰ΩúÁ©∫Èó¥ÈÖçÁΩÆ
[workspace]
members = [
    "css-in-rust",
    "css-in-rust-macros",
    "examples/*"
]

# ÂÖÉÊï∞ÊçÆ
[package.metadata.css-in-rust]
# CSS-in-Rust ÁâπÂÆöÂÖÉÊï∞ÊçÆ
config_file = "css-in-rust.toml"
themes_dir = "themes"
output_dir = "dist"
```

### 2. Êù°‰ª∂ÁºñËØëÈÖçÁΩÆ

```toml
# Âπ≥Âè∞ÁâπÂÆö‰æùËµñ
[target.'cfg(target_arch = "wasm32")'.dependencies]
wasm-bindgen = "0.2"
web-sys = "0.3"
js-sys = "0.3"

[target.'cfg(not(target_arch = "wasm32"))'.dependencies]
tokio = { version = "1.0", features = ["full"] }

# ÂºÄÂèëÁéØÂ¢ÉÁâπÂÆö
[target.'cfg(debug_assertions)'.dependencies]
css-in-rust = { version = "0.1.0", features = ["hot-reload", "diagnostics"] }

# Áîü‰∫ßÁéØÂ¢ÉÁâπÂÆö
[target.'cfg(not(debug_assertions))'.dependencies]
css-in-rust = { version = "0.1.0", features = ["performance", "optimization"] }
```

## üåç ÁéØÂ¢ÉÂèòÈáèÈÖçÁΩÆ

### 1. ÂºÄÂèëÁéØÂ¢ÉÂèòÈáè

```bash
# .env.development
# CSS-in-Rust ÈÖçÁΩÆ
CSS_IN_RUST_ENV=development
CSS_IN_RUST_HOT_RELOAD=true
CSS_IN_RUST_WEBSOCKET_PORT=3001
CSS_IN_RUST_LOG_LEVEL=debug
CSS_IN_RUST_CACHE_DIR=.cache/css-in-rust

# ÁºñËØëÈÖçÁΩÆ
CSS_IN_RUST_MINIFY=false
CSS_IN_RUST_SOURCE_MAPS=true
CSS_IN_RUST_DEAD_CODE_ELIMINATION=false

# ÊÄßËÉΩÈÖçÁΩÆ
CSS_IN_RUST_CACHE_STRATEGY=conservative
CSS_IN_RUST_PARALLEL_JOBS=2

# ‰∏ªÈ¢òÈÖçÁΩÆ
CSS_IN_RUST_DEFAULT_THEME=light
CSS_IN_RUST_THEME_TRANSITIONS=true

# ËØäÊñ≠ÈÖçÁΩÆ
CSS_IN_RUST_VERBOSE_LOGGING=true
CSS_IN_RUST_PERFORMANCE_MONITORING=true
CSS_IN_RUST_GENERATE_REPORTS=true
```

### 2. Áîü‰∫ßÁéØÂ¢ÉÂèòÈáè

```bash
# .env.production
# CSS-in-Rust ÈÖçÁΩÆ
CSS_IN_RUST_ENV=production
CSS_IN_RUST_HOT_RELOAD=false
CSS_IN_RUST_LOG_LEVEL=warn

# ÁºñËØëÈÖçÁΩÆ
CSS_IN_RUST_MINIFY=true
CSS_IN_RUST_SOURCE_MAPS=false
CSS_IN_RUST_DEAD_CODE_ELIMINATION=true
CSS_IN_RUST_OPTIMIZATION_LEVEL=3

# ÊÄßËÉΩÈÖçÁΩÆ
CSS_IN_RUST_CACHE_STRATEGY=aggressive
CSS_IN_RUST_PARALLEL_JOBS=4
CSS_IN_RUST_PRELOAD_CRITICAL_CSS=true

# ÂéãÁº©ÈÖçÁΩÆ
CSS_IN_RUST_COMPRESSION_LEVEL=9
CSS_IN_RUST_BROTLI_COMPRESSION=true
CSS_IN_RUST_REMOVE_UNUSED_CSS=true

# ËæìÂá∫ÈÖçÁΩÆ
CSS_IN_RUST_HASH_FILENAMES=true
CSS_IN_RUST_PUBLIC_PATH=/static/
```

### 3. ÁéØÂ¢ÉÂèòÈáè‰ΩøÁî®Á§∫‰æã

```rust
// src/config.rs
use std::env;

/// ‰ªéÁéØÂ¢ÉÂèòÈáèÂä†ËΩΩÈÖçÁΩÆ
pub fn load_config_from_env() -> CssInRustConfig {
    CssInRustConfig {
        // Âü∫Á°ÄÈÖçÁΩÆ
        environment: env::var("CSS_IN_RUST_ENV")
            .unwrap_or_else(|_| "development".to_string()),

        // ÁÉ≠Êõ¥Êñ∞ÈÖçÁΩÆ
        hot_reload: env::var("CSS_IN_RUST_HOT_RELOAD")
            .map(|v| v.parse().unwrap_or(false))
            .unwrap_or(cfg!(debug_assertions)),

        websocket_port: env::var("CSS_IN_RUST_WEBSOCKET_PORT")
            .map(|v| v.parse().unwrap_or(3001))
            .unwrap_or(3001),

        // ÁºñËØëÈÖçÁΩÆ
        minify: env::var("CSS_IN_RUST_MINIFY")
            .map(|v| v.parse().unwrap_or(false))
            .unwrap_or(!cfg!(debug_assertions)),

        source_maps: env::var("CSS_IN_RUST_SOURCE_MAPS")
            .map(|v| v.parse().unwrap_or(false))
            .unwrap_or(cfg!(debug_assertions)),

        dead_code_elimination: env::var("CSS_IN_RUST_DEAD_CODE_ELIMINATION")
            .map(|v| v.parse().unwrap_or(false))
            .unwrap_or(!cfg!(debug_assertions)),

        // ÊÄßËÉΩÈÖçÁΩÆ
        cache_strategy: env::var("CSS_IN_RUST_CACHE_STRATEGY")
            .unwrap_or_else(|_| {
                if cfg!(debug_assertions) {
                    "conservative".to_string()
                } else {
                    "aggressive".to_string()
                }
            }),

        parallel_jobs: env::var("CSS_IN_RUST_PARALLEL_JOBS")
            .map(|v| v.parse().unwrap_or(num_cpus::get()))
            .unwrap_or(num_cpus::get()),

        // Êó•ÂøóÈÖçÁΩÆ
        log_level: env::var("CSS_IN_RUST_LOG_LEVEL")
            .unwrap_or_else(|_| "info".to_string()),

        verbose_logging: env::var("CSS_IN_RUST_VERBOSE_LOGGING")
            .map(|v| v.parse().unwrap_or(false))
            .unwrap_or(false),

        // ‰∏ªÈ¢òÈÖçÁΩÆ
        default_theme: env::var("CSS_IN_RUST_DEFAULT_THEME")
            .unwrap_or_else(|_| "light".to_string()),

        // ËæìÂá∫ÈÖçÁΩÆ
        output_dir: env::var("CSS_IN_RUST_OUTPUT_DIR")
            .unwrap_or_else(|_| "dist".to_string()),

        cache_dir: env::var("CSS_IN_RUST_CACHE_DIR")
            .unwrap_or_else(|_| ".cache/css-in-rust".to_string()),

        public_path: env::var("CSS_IN_RUST_PUBLIC_PATH")
            .unwrap_or_else(|_| "/".to_string()),
    }
}

/// ÈÖçÁΩÆÁªìÊûÑ‰Ωì
#[derive(Debug, Clone)]
pub struct CssInRustConfig {
    pub environment: String,
    pub hot_reload: bool,
    pub websocket_port: u16,
    pub minify: bool,
    pub source_maps: bool,
    pub dead_code_elimination: bool,
    pub cache_strategy: String,
    pub parallel_jobs: usize,
    pub log_level: String,
    pub verbose_logging: bool,
    pub default_theme: String,
    pub output_dir: String,
    pub cache_dir: String,
    pub public_path: String,
}

impl Default for CssInRustConfig {
    fn default() -> Self {
        load_config_from_env()
    }
}
```

## üî® ÊûÑÂª∫ËÑöÊú¨ÈÖçÁΩÆ

### 1. Âü∫Á°ÄÊûÑÂª∫ËÑöÊú¨ (`build.rs`)

```rust
// build.rs
use css_in_rust::build_tools::{
    CssBuildProcessor, BuildConfig, StaticAnalyzer
};
use std::env;
use std::path::PathBuf;

fn main() -> Result<(), Box<dyn std::error::Error>> {
    // Ëé∑ÂèñÊûÑÂª∫ÁéØÂ¢É
    let profile = env::var("PROFILE").unwrap_or_else(|_| "debug".to_string());
    let is_release = profile == "release";

    // ÂàõÂª∫ÊûÑÂª∫ÈÖçÁΩÆ
    let config = BuildConfig {
        project_root: PathBuf::from(env::var("CARGO_MANIFEST_DIR")?),
        output_dir: PathBuf::from("target").join(&profile).join("css"),

        // Ê†πÊçÆÊûÑÂª∫Á±ªÂûãË∞ÉÊï¥ÈÖçÁΩÆ
        dead_code_elimination: is_release,
        minify: is_release,
        generate_source_maps: !is_release,

        // ‰ºòÂåñÈÖçÁΩÆ
        optimization_level: if is_release { 3 } else { 0 },
        parallel_processing: true,
        max_parallel_jobs: num_cpus::get(),

        // ÁºìÂ≠òÈÖçÁΩÆ
        enable_caching: true,
        cache_dir: PathBuf::from(".cache/css-in-rust"),

        // ÂàÜÊûêÈÖçÁΩÆ
        usage_threshold: 0.1, // 10% ‰ΩøÁî®ÁéáÈòàÂÄº
        aggressive_elimination: is_release,

        // Êä•ÂëäÈÖçÁΩÆ
        generate_reports: env::var("CSS_IN_RUST_GENERATE_REPORTS")
            .map(|v| v.parse().unwrap_or(false))
            .unwrap_or(is_release),

        reports_dir: PathBuf::from("reports"),

        // ÁõëÊéßÈÖçÁΩÆ
        watch_files: vec![
            "src/**/*.rs".to_string(),
            "components/**/*.rs".to_string(),
            "styles/**/*.css".to_string(),
        ],

        ignore_patterns: vec![
            "target/**".to_string(),
            "**/.git/**".to_string(),
            "**/node_modules/**".to_string(),
        ],
    };

    // ÂàõÂª∫ÊûÑÂª∫Â§ÑÁêÜÂô®
    let mut processor = CssBuildProcessor::new(config)?;

    // ËÆæÁΩÆÁéØÂ¢ÉÁâπÂÆöÈÖçÁΩÆ
    if let Ok(custom_config) = env::var("CSS_IN_RUST_CONFIG") {
        processor.load_config_file(&custom_config)?;
    }

    // ÊâßË°åÊûÑÂª∫
    let result = processor.run()?;

    // ËæìÂá∫ÊûÑÂª∫‰ø°ÊÅØ
    println!("cargo:rerun-if-changed=src/");
    println!("cargo:rerun-if-changed=components/");
    println!("cargo:rerun-if-changed=css-in-rust.toml");

    // ËÆæÁΩÆÁéØÂ¢ÉÂèòÈáè
    println!("cargo:rustc-env=CSS_IN_RUST_VERSION={}", env!("CARGO_PKG_VERSION"));
    println!("cargo:rustc-env=CSS_IN_RUST_BUILD_TIME={}", chrono::Utc::now().to_rfc3339());
    println!("cargo:rustc-env=CSS_IN_RUST_PROFILE={}", profile);

    // ËæìÂá∫ÊûÑÂª∫ÁªüËÆ°
    if result.stats.files_processed > 0 {
        println!("cargo:warning=CSS-in-Rust: Â§ÑÁêÜ‰∫Ü {} ‰∏™Êñá‰ª∂", result.stats.files_processed);
        println!("cargo:warning=CSS-in-Rust: ÁîüÊàê‰∫Ü {} bytes CSS", result.stats.total_css_size);

        if result.stats.eliminated_selectors > 0 {
            println!("cargo:warning=CSS-in-Rust: Ê∂àÈô§‰∫Ü {} ‰∏™Êú™‰ΩøÁî®ÁöÑÈÄâÊã©Âô®", result.stats.eliminated_selectors);
        }
    }

    Ok(())
}
```

### 2. È´òÁ∫ßÊûÑÂª∫ÈÖçÁΩÆ

```rust
// build.rs (È´òÁ∫ßÁâàÊú¨)
use css_in_rust::build_tools::*;
use std::collections::HashMap;
use std::env;
use std::fs;
use std::path::PathBuf;

fn main() -> Result<(), Box<dyn std::error::Error>> {
    // Âä†ËΩΩÈÖçÁΩÆÊñá‰ª∂
    let config = load_build_config()?;

    // ÂàõÂª∫ÈùôÊÄÅÂàÜÊûêÂô®
    let analyzer = StaticAnalyzer::new()
        .with_root_dir(&config.project_root)
        .with_include_patterns(&config.watch_files)
        .with_exclude_patterns(&config.ignore_patterns)
        .with_dependency_analysis(true);

    // ÊâßË°åÈùôÊÄÅÂàÜÊûê
    let analysis_result = analyzer.analyze()?;

    // ÂàõÂª∫ÊûÑÂª∫Â§ÑÁêÜÂô®
    let mut processor = CssBuildProcessor::new(config.clone())?;

    // Â∫îÁî®ÂàÜÊûêÁªìÊûú
    processor.apply_analysis(&analysis_result)?;

    // ËÆæÁΩÆËá™ÂÆö‰πâ‰ºòÂåñÂô®
    if config.custom_optimizations {
        processor.add_optimizer(Box::new(CustomCssOptimizer::new()));
    }

    // ËÆæÁΩÆÊèí‰ª∂
    for plugin_config in &config.plugins {
        let plugin = load_plugin(plugin_config)?;
        processor.add_plugin(plugin);
    }

    // ÊâßË°åÊûÑÂª∫
    let build_result = processor.run()?;

    // ÁîüÊàêÊûÑÂª∫Êä•Âëä
    if config.generate_reports {
        generate_build_report(&build_result, &config.reports_dir)?;
    }

    // ËÆæÁΩÆ Cargo ÈáçÊñ∞ÊûÑÂª∫Ëß¶ÂèëÂô®
    setup_cargo_rerun_triggers(&config)?;

    // ËæìÂá∫ÊûÑÂª∫‰ø°ÊÅØÂà∞ÁéØÂ¢ÉÂèòÈáè
    export_build_info(&build_result)?;

    Ok(())
}

/// Âä†ËΩΩÊûÑÂª∫ÈÖçÁΩÆ
fn load_build_config() -> Result<BuildConfig, Box<dyn std::error::Error>> {
    let manifest_dir = PathBuf::from(env::var("CARGO_MANIFEST_DIR")?);
    let profile = env::var("PROFILE").unwrap_or_else(|_| "debug".to_string());

    // Â∞ùËØïÂä†ËΩΩÈÖçÁΩÆÊñá‰ª∂
    let config_paths = vec![
        manifest_dir.join("css-in-rust.toml"),
        manifest_dir.join(format!("css-in-rust.{}.toml", profile)),
        manifest_dir.join(".css-in-rust.toml"),
    ];

    for config_path in config_paths {
        if config_path.exists() {
            let config_content = fs::read_to_string(&config_path)?;
            let mut config: BuildConfig = toml::from_str(&config_content)?;

            // Â∫îÁî®ÁéØÂ¢ÉÂèòÈáèË¶ÜÁõñ
            apply_env_overrides(&mut config)?;

            return Ok(config);
        }
    }

    // ‰ΩøÁî®ÈªòËÆ§ÈÖçÁΩÆ
    let mut config = BuildConfig::default();
    config.project_root = manifest_dir;
    apply_env_overrides(&mut config)?;

    Ok(config)
}

/// Â∫îÁî®ÁéØÂ¢ÉÂèòÈáèË¶ÜÁõñ
fn apply_env_overrides(config: &mut BuildConfig) -> Result<(), Box<dyn std::error::Error>> {
    if let Ok(value) = env::var("CSS_IN_RUST_MINIFY") {
        config.minify = value.parse()?;
    }

    if let Ok(value) = env::var("CSS_IN_RUST_DEAD_CODE_ELIMINATION") {
        config.dead_code_elimination = value.parse()?;
    }

    if let Ok(value) = env::var("CSS_IN_RUST_PARALLEL_JOBS") {
        config.max_parallel_jobs = value.parse()?;
    }

    if let Ok(value) = env::var("CSS_IN_RUST_OUTPUT_DIR") {
        config.output_dir = PathBuf::from(value);
    }

    Ok(())
}

/// ËÆæÁΩÆ Cargo ÈáçÊñ∞ÊûÑÂª∫Ëß¶ÂèëÂô®
fn setup_cargo_rerun_triggers(config: &BuildConfig) -> Result<(), Box<dyn std::error::Error>> {
    // ÁõëÊéßÊ∫êÊñá‰ª∂
    for pattern in &config.watch_files {
        if let Some(dir) = pattern.split("/**").next() {
            println!("cargo:rerun-if-changed={}", dir);
        }
    }

    // ÁõëÊéßÈÖçÁΩÆÊñá‰ª∂
    let config_files = vec![
        "css-in-rust.toml",
        "css-in-rust.development.toml",
        "css-in-rust.production.toml",
        ".css-in-rust.toml",
    ];

    for config_file in config_files {
        println!("cargo:rerun-if-changed={}", config_file);
    }

    // ÁõëÊéßÁéØÂ¢ÉÂèòÈáè
    let env_vars = vec![
        "CSS_IN_RUST_MINIFY",
        "CSS_IN_RUST_DEAD_CODE_ELIMINATION",
        "CSS_IN_RUST_PARALLEL_JOBS",
        "CSS_IN_RUST_OUTPUT_DIR",
    ];

    for env_var in env_vars {
        println!("cargo:rerun-if-env-changed={}", env_var);
    }

    Ok(())
}

/// ÂØºÂá∫ÊûÑÂª∫‰ø°ÊÅØÂà∞ÁéØÂ¢ÉÂèòÈáè
fn export_build_info(result: &BuildResult) -> Result<(), Box<dyn std::error::Error>> {
    println!("cargo:rustc-env=CSS_IN_RUST_FILES_PROCESSED={}", result.stats.files_processed);
    println!("cargo:rustc-env=CSS_IN_RUST_TOTAL_CSS_SIZE={}", result.stats.total_css_size);
    println!("cargo:rustc-env=CSS_IN_RUST_ELIMINATED_SELECTORS={}", result.stats.eliminated_selectors);
    println!("cargo:rustc-env=CSS_IN_RUST_BUILD_DURATION_MS={}", result.stats.build_duration.as_millis());

    Ok(())
}

/// ÁîüÊàêÊûÑÂª∫Êä•Âëä
fn generate_build_report(
    result: &BuildResult,
    reports_dir: &PathBuf,
) -> Result<(), Box<dyn std::error::Error>> {
    fs::create_dir_all(reports_dir)?;

    // ÁîüÊàê JSON Êä•Âëä
    let json_report = serde_json::to_string_pretty(&result.stats)?;
    fs::write(reports_dir.join("build-stats.json"), json_report)?;

    // ÁîüÊàê HTML Êä•Âëä
    let html_report = generate_html_report(&result.stats)?;
    fs::write(reports_dir.join("build-report.html"), html_report)?;

    println!("cargo:warning=ÊûÑÂª∫Êä•ÂëäÂ∑≤ÁîüÊàêÂà∞ {:?}", reports_dir);

    Ok(())
}

/// ÁîüÊàê HTML Êä•Âëä
fn generate_html_report(stats: &BuildStats) -> Result<String, Box<dyn std::error::Error>> {
    let html = format!(r#"
<!DOCTYPE html>
<html>
<head>
    <title>CSS-in-Rust ÊûÑÂª∫Êä•Âëä</title>
    <style>
        body {{ font-family: Arial, sans-serif; margin: 20px; }}
        .stat {{ margin: 10px 0; }}
        .value {{ font-weight: bold; color: #007bff; }}
    </style>
</head>
<body>
    <h1>CSS-in-Rust ÊûÑÂª∫Êä•Âëä</h1>
    <div class="stat">Â§ÑÁêÜÊñá‰ª∂Êï∞: <span class="value">{}</span></div>
    <div class="stat">ÊÄª CSS Â§ßÂ∞è: <span class="value">{} bytes</span></div>
    <div class="stat">Ê∂àÈô§ÈÄâÊã©Âô®Êï∞: <span class="value">{}</span></div>
    <div class="stat">ÊûÑÂª∫ËÄóÊó∂: <span class="value">{} ms</span></div>
    <div class="stat">ÊûÑÂª∫Êó∂Èó¥: <span class="value">{}</span></div>
</body>
</html>
"#,
        stats.files_processed,
        stats.total_css_size,
        stats.eliminated_selectors,
        stats.build_duration.as_millis(),
        chrono::Utc::now().format("%Y-%m-%d %H:%M:%S UTC")
    );

    Ok(html)
}
```

## ‚öôÔ∏è ËøêË°åÊó∂ÈÖçÁΩÆ

### 1. Âä®ÊÄÅÈÖçÁΩÆÁÆ°ÁêÜ

```rust
// src/config/runtime.rs
use css_in_rust::runtime::{RuntimeConfig, ConfigManager};
use std::sync::{Arc, RwLock};
use std::collections::HashMap;

/// ËøêË°åÊó∂ÈÖçÁΩÆÁÆ°ÁêÜÂô®
pub struct RuntimeConfigManager {
    config: Arc<RwLock<RuntimeConfig>>,
    watchers: Vec<Box<dyn Fn(&RuntimeConfig) + Send + Sync>>,
}

impl RuntimeConfigManager {
    /// ÂàõÂª∫Êñ∞ÁöÑÈÖçÁΩÆÁÆ°ÁêÜÂô®
    pub fn new() -> Self {
        let config = RuntimeConfig::default();

        Self {
            config: Arc::new(RwLock::new(config)),
            watchers: Vec::new(),
        }
    }

    /// ‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩÈÖçÁΩÆ
    pub fn load_from_storage(&mut self) -> Result<(), Box<dyn std::error::Error>> {
        #[cfg(target_arch = "wasm32")]
        {
            use web_sys::window;

            if let Some(storage) = window()
                .and_then(|w| w.local_storage().ok())
                .flatten()
            {
                if let Ok(Some(config_json)) = storage.get_item("css-in-rust-config") {
                    let config: RuntimeConfig = serde_json::from_str(&config_json)?;
                    self.update_config(config);
                }
            }
        }

        Ok(())
    }

    /// ‰øùÂ≠òÈÖçÁΩÆÂà∞Êú¨Âú∞Â≠òÂÇ®
    pub fn save_to_storage(&self) -> Result<(), Box<dyn std::error::Error>> {
        #[cfg(target_arch = "wasm32")]
        {
            use web_sys::window;

            let config = self.config.read().unwrap();
            let config_json = serde_json::to_string(&*config)?;

            if let Some(storage) = window()
                .and_then(|w| w.local_storage().ok())
                .flatten()
            {
                storage.set_item("css-in-rust-config", &config_json)?;
            }
        }

        Ok(())
    }

    /// Êõ¥Êñ∞ÈÖçÁΩÆ
    pub fn update_config(&mut self, new_config: RuntimeConfig) {
        {
            let mut config = self.config.write().unwrap();
            *config = new_config;
        }

        // ÈÄöÁü•ËßÇÂØüËÄÖ
        let config = self.config.read().unwrap();
        for watcher in &self.watchers {
            watcher(&*config);
        }

        // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
        let _ = self.save_to_storage();
    }

    /// Ëé∑ÂèñÈÖçÁΩÆ
    pub fn get_config(&self) -> RuntimeConfig {
        self.config.read().unwrap().clone()
    }

    /// Ê∑ªÂä†ÈÖçÁΩÆËßÇÂØüËÄÖ
    pub fn add_watcher<F>(&mut self, watcher: F)
    where
        F: Fn(&RuntimeConfig) + Send + Sync + 'static,
    {
        self.watchers.push(Box::new(watcher));
    }

    /// Êõ¥Êñ∞‰∏ªÈ¢ò
    pub fn set_theme(&mut self, theme_name: String) {
        let mut config = self.config.write().unwrap();
        config.theme.current = theme_name;
        drop(config);

        let config = self.config.read().unwrap();
        for watcher in &self.watchers {
            watcher(&*config);
        }
    }

    /// ÂàáÊç¢‰∏ªÈ¢ò
    pub fn toggle_theme(&mut self) {
        let current_theme = {
            let config = self.config.read().unwrap();
            config.theme.current.clone()
        };

        let new_theme = match current_theme.as_str() {
            "light" => "dark".to_string(),
            "dark" => "light".to_string(),
            _ => "light".to_string(),
        };

        self.set_theme(new_theme);
    }

    /// Êõ¥Êñ∞ÊÄßËÉΩËÆæÁΩÆ
    pub fn update_performance_settings(&mut self, settings: PerformanceSettings) {
        let mut config = self.config.write().unwrap();
        config.performance = settings;
        drop(config);

        let config = self.config.read().unwrap();
        for watcher in &self.watchers {
            watcher(&*config);
        }
    }
}

/// ËøêË°åÊó∂ÈÖçÁΩÆÁªìÊûÑ‰Ωì
#[derive(Debug, Clone, serde::Serialize, serde::Deserialize)]
pub struct RuntimeConfig {
    pub theme: ThemeConfig,
    pub performance: PerformanceSettings,
    pub development: DevelopmentSettings,
    pub accessibility: AccessibilitySettings,
    pub user_preferences: UserPreferences,
}

#[derive(Debug, Clone, serde::Serialize, serde::Deserialize)]
pub struct ThemeConfig {
    pub current: String,
    pub auto_switch: bool,
    pub transition_duration: u32,
    pub respect_system_preference: bool,
}

#[derive(Debug, Clone, serde::Serialize, serde::Deserialize)]
pub struct PerformanceSettings {
    pub enable_caching: bool,
    pub lazy_loading: bool,
    pub preload_critical: bool,
    pub batch_updates: bool,
    pub debounce_ms: u32,
}

#[derive(Debug, Clone, serde::Serialize, serde::Deserialize)]
pub struct DevelopmentSettings {
    pub hot_reload: bool,
    pub show_debug_info: bool,
    pub verbose_logging: bool,
    pub performance_monitoring: bool,
}

#[derive(Debug, Clone, serde::Serialize, serde::Deserialize)]
pub struct AccessibilitySettings {
    pub high_contrast: bool,
    pub reduce_motion: bool,
    pub large_text: bool,
    pub focus_indicators: bool,
}

#[derive(Debug, Clone, serde::Serialize, serde::Deserialize)]
pub struct UserPreferences {
    pub language: String,
    pub timezone: String,
    pub custom_properties: HashMap<String, String>,
}

impl Default for RuntimeConfig {
    fn default() -> Self {
        Self {
            theme: ThemeConfig {
                current: "light".to_string(),
                auto_switch: false,
                transition_duration: 300,
                respect_system_preference: true,
            },
            performance: PerformanceSettings {
                enable_caching: true,
                lazy_loading: true,
                preload_critical: true,
                batch_updates: true,
                debounce_ms: 16,
            },
            development: DevelopmentSettings {
                hot_reload: cfg!(debug_assertions),
                show_debug_info: cfg!(debug_assertions),
                verbose_logging: false,
                performance_monitoring: true,
            },
            accessibility: AccessibilitySettings {
                high_contrast: false,
                reduce_motion: false,
                large_text: false,
                focus_indicators: true,
            },
            user_preferences: UserPreferences {
                language: "zh-CN".to_string(),
                timezone: "Asia/Shanghai".to_string(),
                custom_properties: HashMap::new(),
            },
        }
    }
}
```

### 2. ÈÖçÁΩÆ Hook Á§∫‰æã

```rust
// src/hooks/use_config.rs (Yew Á§∫‰æã)
use yew::prelude::*;
use crate::config::RuntimeConfigManager;
use std::rc::Rc;

/// ÈÖçÁΩÆ Hook
#[hook]
pub fn use_config() -> (RuntimeConfig, Callback<RuntimeConfig>) {
    let config_manager = use_state(|| Rc::new(RefCell::new(RuntimeConfigManager::new())));
    let config = use_state(|| config_manager.borrow().get_config());

    // ÂàùÂßãÂåñÊó∂Âä†ËΩΩÈÖçÁΩÆ
    use_effect_with_deps(
        {
            let config_manager = config_manager.clone();
            let config = config.clone();

            move |_| {
                let mut manager = config_manager.borrow_mut();
                let _ = manager.load_from_storage();
                config.set(manager.get_config());

                // Ê∑ªÂä†ÈÖçÁΩÆËßÇÂØüËÄÖ
                manager.add_watcher({
                    let config = config.clone();
                    move |new_config| {
                        config.set(new_config.clone());
                    }
                });

                || {}
            }
        },
        (),
    );

    let update_config = {
        let config_manager = config_manager.clone();

        Callback::from(move |new_config: RuntimeConfig| {
            config_manager.borrow_mut().update_config(new_config);
        })
    };

    ((*config).clone(), update_config)
}

/// ‰∏ªÈ¢ò Hook
#[hook]
pub fn use_theme() -> (String, Callback<String>) {
    let (config, update_config) = use_config();

    let set_theme = {
        let config = config.clone();

        Callback::from(move |theme_name: String| {
            let mut new_config = config.clone();
            new_config.theme.current = theme_name;
            update_config.emit(new_config);
        })
    };

    (config.theme.current, set_theme)
}
```

## üìã ÈÖçÁΩÆÊúÄ‰Ω≥ÂÆûË∑µ

### ‚úÖ ÈÖçÁΩÆÁªÑÁªá
- [ ] ‰ΩøÁî®ÂàÜÂ±ÇÈÖçÁΩÆÔºàÈªòËÆ§ ‚Üí ÁéØÂ¢É ‚Üí Áî®Êà∑Ôºâ
- [ ] Êèê‰æõÂêàÁêÜÁöÑÈªòËÆ§ÂÄº
- [ ] ÊîØÊåÅÁéØÂ¢ÉÂèòÈáèË¶ÜÁõñ
- [ ] ‰ΩøÁî®Á±ªÂûãÂÆâÂÖ®ÁöÑÈÖçÁΩÆÁªìÊûÑ

### ‚úÖ ÊÄßËÉΩ‰ºòÂåñ
- [ ] ÁºìÂ≠òÈÖçÁΩÆËß£ÊûêÁªìÊûú
- [ ] ‰ΩøÁî®ÊáíÂä†ËΩΩÂä†ËΩΩÂ§ßÂûãÈÖçÁΩÆ
- [ ] ÈÅøÂÖçÈ¢ëÁπÅÁöÑÈÖçÁΩÆÊõ¥Êñ∞
- [ ] ÂêàÁêÜ‰ΩøÁî®ÈÖçÁΩÆËßÇÂØüËÄÖ

### ‚úÖ ÂºÄÂèë‰ΩìÈ™å
- [ ] Êèê‰æõÈÖçÁΩÆÈ™åËØÅÂíåÈîôËØØÊèêÁ§∫
- [ ] ÊîØÊåÅÈÖçÁΩÆÁÉ≠ÈáçËΩΩ
- [ ] ÁîüÊàêÈÖçÁΩÆÊñáÊ°£ÂíåÁ§∫‰æã
- [ ] Êèê‰æõÈÖçÁΩÆËøÅÁßªÂ∑•ÂÖ∑

### ‚úÖ ÂÆâÂÖ®ËÄÉËôë
- [ ] ÈÅøÂÖçÂú®ÈÖçÁΩÆ‰∏≠Â≠òÂÇ®ÊïèÊÑü‰ø°ÊÅØ
- [ ] È™åËØÅÁî®Êà∑ËæìÂÖ•ÁöÑÈÖçÁΩÆÂÄº
- [ ] ‰ΩøÁî®ÂÆâÂÖ®ÁöÑÈªòËÆ§ÈÖçÁΩÆ
- [ ] ÈôêÂà∂ÈÖçÁΩÆÊñá‰ª∂ÁöÑËÆøÈóÆÊùÉÈôê

ÈÄöËøáÂêàÁêÜÁöÑÈÖçÁΩÆÁÆ°ÁêÜÔºåÊÇ®ÂèØ‰ª•ËÆ© CSS-in-Rust È°πÁõÆÊõ¥Âä†ÁÅµÊ¥ª„ÄÅÂèØÁª¥Êä§ÂíåÈ´òÊÄßËÉΩÔºÅ‚öôÔ∏è
